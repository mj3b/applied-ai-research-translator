{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "tasks.schema.json",
  "title": "Tasks",
  "type": "object",
  "additionalProperties": false,
  "required": ["tasks_version", "pack_id", "created_at", "source", "tasks"],
  "properties": {
    "tasks_version": { "type": "string" },
    "pack_id": { "type": "string" },
    "created_at": { "type": "string" },
    "source": {
      "type": "object",
      "additionalProperties": false,
      "required": ["claims_path", "method"],
      "properties": {
        "claims_path": { "type": "string" },
        "method": { "type": "string" },
        "notes": { "type": "string" }
      }
    },
    "tasks": {
      "type": "array",
      "minItems": 1,
      "items": { "$ref": "#/$defs/task" }
    }
  },
  "$defs": {
    "task": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "task_id",
        "from_claim_id",
        "name",
        "objective",
        "inputs",
        "outputs",
        "constraints",
        "abstention",
        "evaluation",
        "governance"
      ],
      "properties": {
        "task_id": { "type": "string" },
        "from_claim_id": { "type": "string" },
        "name": { "type": "string" },
        "objective": { "type": "string" },

        "inputs": {
          "type": "object",
          "additionalProperties": false,
          "required": ["required", "optional"],
          "properties": {
            "required": { "type": "array", "items": { "$ref": "#/$defs/field" } },
            "optional": { "type": "array", "items": { "$ref": "#/$defs/field" } }
          }
        },

        "outputs": {
          "type": "object",
          "additionalProperties": false,
          "required": ["primary_schema", "evidence_items_min"],
          "properties": {
            "primary_schema": { "type": "object" },
            "evidence_items_min": { "type": "integer", "minimum": 0 }
          }
        },

        "constraints": {
          "type": "object",
          "additionalProperties": false,
          "required": ["assumptions", "non_goals", "allowed_tools"],
          "properties": {
            "assumptions": { "type": "array", "items": { "type": "string" } },
            "non_goals": { "type": "array", "items": { "type": "string" } },
            "allowed_tools": { "type": "array", "items": { "type": "string" } }
          }
        },

        "abstention": {
          "type": "object",
          "additionalProperties": false,
          "required": ["required", "triggers", "fallback_action"],
          "properties": {
            "required": { "type": "boolean" },
            "triggers": { "type": "array", "items": { "type": "string" } },
            "fallback_action": { "type": "string" }
          }
        },

        "evaluation": {
          "type": "object",
          "additionalProperties": false,
          "required": ["metrics", "acceptance_thresholds", "test_set_plan"],
          "properties": {
            "metrics": { "type": "array", "items": { "type": "string" } },
            "acceptance_thresholds": { "type": "array", "items": { "type": "string" } },
            "test_set_plan": { "type": "string" }
          }
        },

        "governance": {
          "type": "object",
          "additionalProperties": false,
          "required": ["human_checkpoint", "logging_requirements"],
          "properties": {
            "human_checkpoint": { "type": "string" },
            "logging_requirements": { "type": "array", "items": { "type": "string" } }
          }
        }
      }
    },

    "field": {
      "type": "object",
      "additionalProperties": false,
      "required": ["name", "type", "description", "example"],
      "properties": {
        "name": { "type": "string" },
        "type": { "type": "string" },
        "description": { "type": "string" },
        "example": {}
      }
    }
  }
}
